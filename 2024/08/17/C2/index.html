<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>C2 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Mycat 读写分离部署(1)在 ansible 节点，安装Java 的运行环境。将java–version 命令的返回结果提交到答题框    sudo yum install java-11-openjdk-devel     java -version  （2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1.6-RELEASE-linux.tar.g">
<meta property="og:type" content="article">
<meta property="og:title" content="C2">
<meta property="og:url" content="http://example.com/2024/08/17/C2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Mycat 读写分离部署(1)在 ansible 节点，安装Java 的运行环境。将java–version 命令的返回结果提交到答题框    sudo yum install java-11-openjdk-devel     java -version  （2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1.6-RELEASE-linux.tar.g">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-08-17T07:11:21.000Z">
<meta property="article:modified_time" content="2024-08-17T07:35:08.638Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-C2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/17/C2/" class="article-date">
  <time class="dt-published" datetime="2024-08-17T07:11:21.000Z" itemprop="datePublished">2024-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      C2
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Mycat-读写分离部署"><a href="#Mycat-读写分离部署" class="headerlink" title="Mycat 读写分离部署"></a>Mycat 读写分离部署</h3><h2 id="1-在-ansible-节点，安装Java-的运行环境。将java–version-命令的返回结果提交到答题框"><a href="#1-在-ansible-节点，安装Java-的运行环境。将java–version-命令的返回结果提交到答题框" class="headerlink" title="(1)在 ansible 节点，安装Java 的运行环境。将java–version 命令的返回结果提交到答题框"></a>(1)在 ansible 节点，安装Java 的运行环境。将java–version 命令的返回结果提交到答题框</h2><pre><code>    sudo yum install java-11-openjdk-devel
    java -version
</code></pre>
<h2 id="（2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1-6-RELEASE-linux-tar-gz-解压到-us-r-local-目录下，并完成相关配置。将cat-etc-profile-grep-mycat-命令的返回结果提交到到答题框"><a href="#（2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1-6-RELEASE-linux-tar-gz-解压到-us-r-local-目录下，并完成相关配置。将cat-etc-profile-grep-mycat-命令的返回结果提交到到答题框" class="headerlink" title="（2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1.6-RELEASE-linux.tar.gz 解压到&#x2F;us r&#x2F;local 目录下，并完成相关配置。将cat &#x2F;etc&#x2F;profile | grep mycat 命令的返回结果提交到到答题框"></a>（2）在主机清单创建ansible主机组并添加ansible节点。把Mycat-server-1.6-RELEASE-linux.tar.gz 解压到&#x2F;us r&#x2F;local 目录下，并完成相关配置。将cat &#x2F;etc&#x2F;profile | grep mycat 命令的返回结果提交到到答题框</h2><pre><code>    vi /etc/ansible/hosts
    
    [mycat]
    ansible_node_hostname
解压缩
    sudo tar zxvf /usr/local/Mycat-server-1.6-RELEASE-linux.tar.gz -C /usr/local
配置环境变量
    vi /etc/profile 
    export MYCAT_HOME=/usr/local/Mycat-server-1.6-RELEASE
    export PATH=\$PATH:\$MYCAT_HOME/bin
使环境变量生效
    source /etc/profile
提交
    cat /etc/profile | grep mycat
</code></pre>
<h3 id="编辑-schema-xml-文件"><a href="#编辑-schema-xml-文件" class="headerlink" title="编辑 schema.xml 文件"></a>编辑 schema.xml 文件</h3><p>vi schema.xml Host1是写 host2是读</p>
<pre><code>&lt;!-- /usr/local/Mycat-server-1.6-RELEASE/conf/schema.xml --&gt;
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;
&lt;mycat:schema xmlns:mycat=&quot;http://org.opencloudb/&quot;&gt;
    &lt;schema name=&quot;TESTDB&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;&gt;
        &lt;table name=&quot;*&quot; dataNode=&quot;dn1&quot;/&gt;
        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;db1&quot;/&gt;
        &lt;dataNode name=&quot;dn2&quot; dataHost=&quot;host2&quot; database=&quot;db1&quot;/&gt;
    &lt;/schema&gt;
&lt;/mycat:schema&gt;
编辑 server.xml 文件
&lt;!-- /usr/local/Mycat-server-1.6-RELEASE/conf/server.xml --&gt;
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE mycat:server SYSTEM &quot;server.dtd&quot;&gt;
&lt;mycat:server xmlns:mycat=&quot;http://org.opencloudb/&quot;&gt;
    &lt;system&gt;
        &lt;property name=&quot;server_charset&quot;&gt;UTF-8&lt;/property&gt;
        &lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;
        &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;
    &lt;/system&gt;
    &lt;dataNode name=&quot;host1&quot; dataHost=&quot;host1&quot; database=&quot;db1&quot; /&gt;
    &lt;dataNode name=&quot;host2&quot; dataHost=&quot;host2&quot; database=&quot;db1&quot; /&gt;
&lt;/mycat:server&gt;
</code></pre>
<h3 id="启动Mycat服务"><a href="#启动Mycat服务" class="headerlink" title="启动Mycat服务"></a>启动Mycat服务</h3><pre><code>sudo /usr/local/Mycat-server-1.6-RELEASE/bin/mycat start
</code></pre>
<p>验证Mycat监听端口</p>
<pre><code>netstat -ntpl 
</code></pre>
<h3 id="步骤1：创建主机清单文件"><a href="#步骤1：创建主机清单文件" class="headerlink" title="步骤1：创建主机清单文件"></a>步骤1：创建主机清单文件</h3><p>vi &#x2F;etc&#x2F;ansible&#x2F;hosts</p>
<pre><code>[zookeeper]
ansible
host1 zk_id=1
host2 zk_id=2
</code></pre>
<h3 id="验证Ansible连接"><a href="#验证Ansible连接" class="headerlink" title="验证Ansible连接"></a>验证Ansible连接</h3><pre><code>ansible all -a &quot;id&quot;
</code></pre>
<h3 id="步骤2：编写-zookeeper-yaml-文件"><a href="#步骤2：编写-zookeeper-yaml-文件" class="headerlink" title="步骤2：编写 zookeeper.yaml 文件"></a>步骤2：编写 zookeeper.yaml 文件</h3><p>vi zookeeper.yaml</p>
<pre><code>- name: Deploy Zookeeper Cluster
hosts: zookeeper
become: true
tasks:
    - name: Copy Zookeeper tarball
    copy:
        src: /path/to/zookeeper-3.4.14.tar.gz
        dest: /usr/local/zookeeper-3.4.14.tar.gz
        mode: 0644

    - name: Extract Zookeeper tarball
    ansible.builtin.unarchive:
        src: /usr/local/zookeeper-3.4.14.tar.gz
        dest: /usr/local/
        creates: /usr/local/zookeeper-3.4.14

    - name: Configure Zookeeper
    template:
        src: zoo.cfg.j2
        dest: /usr/local/zookeeper-3.4.14/conf/zoo.cfg
        owner: root
        group: root
        mode: 0644
    notify: Start Zookeeper

    - name: Create myid file for each node
    copy:
        content: &quot;&#123;&#123; zk_id &#125;&#125;&quot;
        dest: &quot;/usr/local/zookeeper-3.4.14/data/myid&quot;
        owner: root
        group: root
        mode: 0644

handlers:
    - name: Start Zookeeper
    ansible.builtin.shell: &quot;/usr/local/zookeeper-3.4.14/bin/zkServer.sh start&quot;
    async: 60
    poll: 0

    - name: Stop Zookeeper
    ansible.builtin.shell: &quot;/usr/local/zookeeper-3.4.14/bin/zkServer.sh stop&quot;
    async: 60
    poll: 0
</code></pre>
<h3 id="ansible-playbook-zookeeper-yaml"><a href="#ansible-playbook-zookeeper-yaml" class="headerlink" title="ansible-playbook zookeeper.yaml"></a>ansible-playbook zookeeper.yaml</h3><h3 id="验证Zookeeper节点状态"><a href="#验证Zookeeper节点状态" class="headerlink" title="验证Zookeeper节点状态"></a>验证Zookeeper节点状态</h3><pre><code>./usr/local/zookeeper-3.4.14/bin/zkServer.sh status
</code></pre>
<p>请将执行 jps 命令的输出结果提交到答题</p>
<h3 id="编写-Ansible-Playbook-kafka-yaml"><a href="#编写-Ansible-Playbook-kafka-yaml" class="headerlink" title="编写 Ansible Playbook (kafka.yaml)"></a>编写 Ansible Playbook (kafka.yaml)</h3><pre><code>- name: Deploy Kafka Cluster
hosts: kafka
become: true
tasks:
    - name: Copy Kafka tarball
    copy:
        src: /usr/local/kafka_2.11-1.1.1.tgz
        dest: /usr/local/kafka_2.11-1.1.1.tgz
        mode: 0644

    - name: Extract Kafka tarball
    ansible.builtin.unarchive:
        src: /usr/local/kafka_2.11-1.1.1.tgz
        dest: /usr/local/
        creates: /usr/local/kafka_2.11-1.1.1

    - name: Configure Kafka server.properties
    template:
        src: server.properties.j2
        dest: /usr/local/kafka_2.11-1.1.1/config/server.properties
        owner: root
        group: root
        mode: 0644
    notify: Start Kafka

handlers:
    - name: Start Kafka
    ansible.builtin.shell: &quot;/usr/local/kafka_2.11-1.1.1/bin/kafka-server-start.sh -daemon /usr/local/kafka_2.11-1.1.1/config/server.properties&quot;
    async: 60
    poll: 0

    - name: Stop Kafka
    ansible.builtin.shell: &quot;/usr/local/kafka_2.11-1.1.1/bin/kafka-server-stop.sh&quot;
    async: 60
    poll: 0
</code></pre>
<h3 id="ansible-playbook-kafka-yaml"><a href="#ansible-playbook-kafka-yaml" class="headerlink" title="ansible-playbook kafka.yaml"></a>ansible-playbook kafka.yaml</h3><h3 id="jps-ml"><a href="#jps-ml" class="headerlink" title="jps -ml"></a>jps -ml</h3><h2 id="任务2-应用商城系统部署"><a href="#任务2-应用商城系统部署" class="headerlink" title="任务2 应用商城系统部署"></a>任务2 应用商城系统部署</h2><h2 id="1-在-ansible-节点，使用提供的gpmall-cluster-软件包，完成集群应用系统部署。部署完成后，进行登录，最后使用curl命令去获取商城首页的返回信息，将curl-l-http-EIP-80-命令的返回结果提交到答题框"><a href="#1-在-ansible-节点，使用提供的gpmall-cluster-软件包，完成集群应用系统部署。部署完成后，进行登录，最后使用curl命令去获取商城首页的返回信息，将curl-l-http-EIP-80-命令的返回结果提交到答题框" class="headerlink" title="1.在 ansible 节点，使用提供的gpmall-cluster 软件包，完成集群应用系统部署。部署完成后，进行登录，最后使用curl命令去获取商城首页的返回信息，将curl-l http://EIP:80 命令的返回结果提交到答题框"></a>1.在 ansible 节点，使用提供的gpmall-cluster 软件包，完成集群应用系统部署。部署完成后，进行登录，最后使用curl命令去获取商城首页的返回信息，将curl-l <a target="_blank" rel="noopener" href="http://eip/">http://EIP:80</a> 命令的返回结果提交到答题框</h2><pre><code>- name: Deploy GPMall Cluster Application
hosts: all
become: true
tasks:
    - name: Copy GPMall Cluster tarball
    copy:
        src: /usr/local/gpmall-cluster.tar.gz  # 假设软件包是 gpmall-cluster.tar.gz
        dest: /usr/local/gpmall-cluster.tar.gz
        mode: 0644

    - name: Extract GPMall Cluster tarball
    ansible.builtin.unarchive:
        src: /usr/local/gpmall-cluster.tar.gz
        dest: /usr/local/
        creates: /usr/local/gpmall-cluster  # 假设解压后的目录为 gpmall-cluster

    # 可以根据具体需要，添加配置文件复制、数据库初始化等任务

handlers:
    - name: Restart Application
    ansible.builtin.systemd:
        name: gpmall-service  # 假设服务名为 gpmall-service
        state: restarted

提交
curl -L http://EIP:80
</code></pre>
<h3 id="任务3-Prometheus监控Mariadb主从数据库"><a href="#任务3-Prometheus监控Mariadb主从数据库" class="headerlink" title="任务3 Prometheus监控Mariadb主从数据库"></a>任务3 Prometheus监控Mariadb主从数据库</h3><h2 id="1-Prometheus-及-Grafana-搭建根据grafana-enterprise-8-3-6-linux-amd64-tar-gz、prometheus-2-37-0-linux-amd64-tar-gz、node-exporter-1-3"><a href="#1-Prometheus-及-Grafana-搭建根据grafana-enterprise-8-3-6-linux-amd64-tar-gz、prometheus-2-37-0-linux-amd64-tar-gz、node-exporter-1-3" class="headerlink" title="1.Prometheus 及 Grafana 搭建根据grafana-enterprise-8.3.6.linux-amd64.tar.gz、prometheus-2.37.0.linux-amd64.tar.gz、node_exporter-1.3."></a>1.Prometheus 及 Grafana 搭建根据grafana-enterprise-8.3.6.linux-amd64.tar.gz、prometheus-2.37.0.linux-amd64.tar.gz、node_exporter-1.3.</h2><p>1.linux-amd64.tar.gz 资源包，安装 prometheus-2.37.0、node_exporter 服务并启动，安装 grafana 服务并测试浏<br>览器登陆。</p>
<pre><code>    （假设上传至 /usr/local 
        # 解压Prometheus软件包
        tar -zxvf /usr/local/prometheus-2.37.0.linux-amd64.tar.gz -C /usr/local/

        # 启动Prometheus服务（示例命令，具体启动方式根据实际需求调整）
        /usr/local/prometheus-2.37.0.linux-amd64/prometheus --config.file=/usr/local/prometheus-2.37.0.linux-amd64/prometheus.yml &amp;

        # 可以根据需要编辑Prometheus配置文件 prometheus.yml，配置数据源等

        # 启动Node Exporter服务
        tar -zxvf /usr/local/node_exporter-1.3.1.linux-amd64.tar.gz -C /usr/local/
        /usr/local/node_exporter-1.3.1.linux-amd64/node_exporter &amp;

        # 可以根据需要配置Node Exporter，例如将其加入系统服务中

        # 验证Prometheus是否正常运行，可以访问 http://&lt;server-ip&gt;:9090 来查看Prometheus控制台
</code></pre>
<p>安装和配置Grafana</p>
<pre><code># 解压Grafana软件包
tar -zxvf /usr/local/grafana-enterprise-8.3.6.linux-amd64.tar.gz -C /usr/local/

# 启动Grafana服务（示例命令，具体启动方式根据实际需求调整）
/usr/local/grafana-enterprise-8.3.6/bin/grafana-server &amp;

# 等待Grafana启动完成，通常在 http://&lt;server-ip&gt;:3000 可以访问Grafana的登录页面

# 在浏览器中访问 http://&lt;server-ip&gt;:3000 ，使用默认账号和密码（admin/admin）登录Grafana
</code></pre>
<p>验证安装结果<br>    访问Prometheus控制台： http:&#x2F;&#x2F;<server-ip>:9090<br>    访问Grafana登录页面： http:&#x2F;&#x2F;<server-ip>:3000</p>
<p>安装和配置mysqld_exporter</p>
<pre><code>准备软件包：

1.将 mysqld_exporter-0.12.1.linux-amd64.tar.gz 上传到目标服务器（假设上传至 /usr/local/ 目录）。

安装mysqld_exporter：
在目标服务器上执行以下操作：
    # 解压mysqld_exporter软件包
    tar -zxvf /usr/local/mysqld_exporter-0.12.1.linux-amd64.tar.gz -C /usr/local/

    # 进入解压后的目录
    cd /usr/local/mysqld_exporter-0.12.1.linux-amd64/

    # 创建并编辑配置文件 my.cnf，添加被监控数据库的用户名和密码
    vi my.cnf
</code></pre>
<p>在 my.cnf 文件中添加以下内容（假设使用root用户，密码为123456）：</p>
<pre><code>    [client]
    user=root
    password=123456
</code></pre>
<p>启动mysqld_exporter：</p>
<pre><code># 启动mysqld_exporter，监听默认端口9104
./mysqld_exporter --config.my-cnf=my.cnf &amp;
</code></pre>
<p>修改Prometheus配置文件 prometheus.yml</p>
<pre><code>在Prometheus服务器上编辑 prometheus.yml 配置文件，添加对mysqld_exporter和node_exporter的监控任务
    global:
      scrape_interval: 5s
      scrape_timeout: 5s

    scrape_configs:
      - job_name: &#39;mysql-ansible-slave&#39;
        static_configs:
          - targets: [&#39;host1:9104&#39;, &#39;host2:9104&#39;]  # 替换为实际的主从节点IP和mysqld_exporter监听端口

      - job_name: &#39;nodes&#39;
        static_configs:
          - targets: [&#39;host1:9100&#39;, &#39;host2:9100&#39;]  # 替换为实际的节点IP和node_exporter监听端口
</code></pre>
<p>重启Prometheus并刷新页面</p>
<pre><code>在Prometheus服务器上执行以下操作：
    # 重启Prometheus服务
    sudo systemctl restart prometheus

    # 访问Prometheus的Web页面，并刷新页面，查看是否能够看到新增的监控任务
</code></pre>
<p>提交答题框<br>请确认完成以上步骤后，访问Prometheus的Web页面，并截图验证是否成功添加了 mysql-ansible-slave 和 nodes 的监控任务。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/17/C2/" data-id="clzxtpt65000265fy0c4b689h" data-title="C2" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/08/17/C1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">C1</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/08/17/C2/">C2</a>
          </li>
        
          <li>
            <a href="/2024/08/17/C1/">C1</a>
          </li>
        
          <li>
            <a href="/2024/08/17/B/">B</a>
          </li>
        
          <li>
            <a href="/2024/08/17/SET/">SET</a>
          </li>
        
          <li>
            <a href="/2024/08/17/A/">A</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>